import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  TextInput,\n  TouchableOpacity,\n  StyleSheet,\n  Alert,\n  ScrollView,\n  ActivityIndicator,\n  AppRegistry,\n} from 'react-native';\nimport { authService } from './src/services/auth_real';\n\nconst colors = {\n  primary: '#6366f1',\n  secondary: '#06b6d4',\n  success: '#10b981',\n  warning: '#f59e0b',\n  error: '#ef4444',\n  background: '#f8fafc',\n  surface: '#ffffff',\n  text: '#1e293b',\n  textSecondary: '#64748b',\n  border: '#e2e8f0',\n};\n\nfunction App() {\n  const [currentScreen, setCurrentScreen] = useState('login');\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [user, setUser] = useState(null);\n  const [tasks, setTasks] = useState([]);\n\n  const handleLogin = async () => {\n    if (!username.trim() || !password.trim()) {\n      Alert.alert('Erro', 'Preencha todos os campos');\n      return;\n    }\n\n    setLoading(true);\n    \n    try {\n      const result = await authService.login(username, password);\n      \n      if (result.success) {\n        setUser(result.user);\n        setCurrentScreen('home');\n        Alert.alert('Sucesso!', `Bem-vindo, ${result.user.fullName}!`);\n        \n        // Carregar tarefas do usuÃ¡rio\n        loadUserTasks(result.user.id);\n      } else {\n        Alert.alert('Erro', result.error || 'Falha na autenticaÃ§Ã£o');\n      }\n    } catch (error) {\n      Alert.alert('Erro', 'Erro de conexÃ£o com servidor');\n    }\n    \n    setLoading(false);\n  };\n\n  const loadUserTasks = async (userId) => {\n    try {\n      const result = await authService.getUserTasks(userId);\n      if (result.success) {\n        setTasks(result.tasks);\n      }\n    } catch (error) {\n      console.error('Erro ao carregar tarefas:', error);\n    }\n  };\n\n  const handleLogout = () => {\n    Alert.alert('Sair', 'Deseja sair do app?', [\n      { text: 'Cancelar', style: 'cancel' },\n      { text: 'Sair', onPress: () => {\n        setCurrentScreen('login');\n        setUsername('');\n        setPassword('');\n        setUser(null);\n        setTasks([]);\n      }}\n    ]);\n  };\n\n  if (currentScreen === 'login') {\n    return (\n      <View style={styles.container}>\n        <View style={styles.logoContainer}>\n          <View style={styles.iconCircle}>\n            <Text style={styles.iconText}>ğŸ”§</Text>\n          </View>\n          <Text style={styles.title}>GCNet Task Manager</Text>\n          <Text style={styles.subtitle}>Sistema Integrado v2.0</Text>\n        </View>\n\n        <View style={styles.formContainer}>\n          <View style={styles.inputContainer}>\n            <Text style={styles.inputIcon}>ğŸ‘¤</Text>\n            <TextInput\n              style={styles.input}\n              placeholder=\"Nome de usuÃ¡rio\"\n              value={username}\n              onChangeText={setUsername}\n              autoCapitalize=\"none\"\n            />\n          </View>\n\n          <View style={styles.inputContainer}>\n            <Text style={styles.inputIcon}>ğŸ”’</Text>\n            <TextInput\n              style={styles.input}\n              placeholder=\"Senha\"\n              value={password}\n              onChangeText={setPassword}\n              secureTextEntry\n            />\n          </View>\n\n          <TouchableOpacity \n            style={[styles.loginButton, loading && styles.buttonDisabled]} \n            onPress={handleLogin}\n            disabled={loading}\n          >\n            {loading ? (\n              <ActivityIndicator color=\"white\" />\n            ) : (\n              <Text style={styles.loginButtonText}>Entrar</Text>\n            )}\n          </TouchableOpacity>\n\n          <Text style={styles.testInfo}>\n            UsuÃ¡rios GCNet disponÃ­veis:\n            {\"\\n\"}â€¢ joao.tecnico / 123456\n            {\"\\n\"}â€¢ maria.instaladora / 123456\n            {\"\\n\"}â€¢ lucas.campo / 123456\n            {\"\\n\"}â€¢ felipe.rede / 123456\n          </Text>\n        </View>\n      </View>\n    );\n  }\n\n  const pendentes = tasks.filter(t => t.status === 'pendente').length;\n  const emAndamento = tasks.filter(t => t.status === 'em_andamento').length;\n  const concluidas = tasks.filter(t => t.status === 'concluida').length;\n\n  return (\n    <ScrollView style={styles.homeContainer}>\n      <View style={styles.header}>\n        <Text style={styles.welcomeTitle}>GCNet - Minhas Tarefas</Text>\n        <Text style={styles.welcomeSubtitle}>{user?.fullName} - {user?.team}</Text>\n      </View>\n      \n      <View style={styles.statsContainer}>\n        <View style={[styles.statCard, styles.pendingCard]}>\n          <Text style={styles.statIcon}>â°</Text>\n          <Text style={styles.statNumber}>{pendentes}</Text>\n          <Text style={styles.statLabel}>Pendentes</Text>\n        </View>\n        <View style={[styles.statCard, styles.progressCard]}>\n          <Text style={styles.statIcon}>ğŸ”„</Text>\n          <Text style={styles.statNumber}>{emAndamento}</Text>\n          <Text style={styles.statLabel}>Em Andamento</Text>\n        </View>\n        <View style={[styles.statCard, styles.completedCard]}>\n          <Text style={styles.statIcon}>âœ…</Text>\n          <Text style={styles.statNumber}>{concluidas}</Text>\n          <Text style={styles.statLabel}>ConcluÃ­das</Text>\n        </View>\n      </View>\n\n      <Text style={styles.sectionTitle}>Tarefas AtribuÃ­das</Text>\n\n      {tasks.length === 0 ? (\n        <View style={styles.emptyState}>\n          <Text style={styles.emptyText}>Nenhuma tarefa atribuÃ­da</Text>\n          <Text style={styles.emptySubtext}>Aguarde novas atribuiÃ§Ãµes do gerente</Text>\n        </View>\n      ) : (\n        tasks.map((task) => (\n          <View key={task.id} style={styles.taskCard}>\n            <View style={styles.taskHeader}>\n              <Text style={styles.taskTitle}>{task.title}</Text>\n              <View style={[\n                styles.priorityDot,\n                { backgroundColor: \n                  task.priority === 'alta' ? colors.error :\n                  task.priority === 'media' ? colors.warning : colors.success\n                }\n              ]} />\n            </View>\n            <Text style={styles.taskDescription}>{task.description}</Text>\n            <Text style={styles.taskAddress}>ğŸ“ {task.address}</Text>\n            <View style={styles.taskFooter}>\n              <View style={[\n                styles.statusBadge,\n                { backgroundColor:\n                  task.status === 'pendente' ? colors.warning :\n                  task.status === 'em_andamento' ? colors.secondary : colors.success\n                }\n              ]}>\n                <Text style={styles.statusText}>\n                  {task.status === 'pendente' ? 'Pendente' :\n                   task.status === 'em_andamento' ? 'Em Andamento' : 'ConcluÃ­da'}\n                </Text>\n              </View>\n              <Text style={styles.taskTime}>â° {new Date(task.due_date).toLocaleDateString()}</Text>\n            </View>\n          </View>\n        ))\n      )}\n\n      <TouchableOpacity style={styles.refreshButton} onPress={() => loadUserTasks(user?.id)}>\n        <Text style={styles.refreshText}>ğŸ”„ Atualizar Tarefas</Text>\n      </TouchableOpacity>\n\n      <TouchableOpacity style={styles.logoutButton} onPress={handleLogout}>\n        <Text style={styles.logoutText}>ğŸšª Sair</Text>\n      </TouchableOpacity>\n    </ScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: colors.background,\n    justifyContent: 'center',\n    padding: 24,\n  },\n  logoContainer: {\n    alignItems: 'center',\n    marginBottom: 40,\n  },\n  iconCircle: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    backgroundColor: colors.primary,\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginBottom: 16,\n  },\n  iconText: {\n    fontSize: 40,\n  },\n  title: {\n    fontSize: 28,\n    fontWeight: 'bold',\n    color: colors.text,\n    marginBottom: 8,\n  },\n  subtitle: {\n    fontSize: 16,\n    color: colors.textSecondary,\n  },\n  formContainer: {\n    width: '100%',\n  },\n  inputContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    backgroundColor: colors.surface,\n    borderRadius: 12,\n    marginBottom: 16,\n    paddingHorizontal: 16,\n    borderWidth: 1,\n    borderColor: colors.border,\n  },\n  inputIcon: {\n    fontSize: 20,\n    marginRight: 12,\n  },\n  input: {\n    flex: 1,\n    paddingVertical: 16,\n    fontSize: 16,\n    color: colors.text,\n  },\n  loginButton: {\n    backgroundColor: colors.primary,\n    borderRadius: 12,\n    paddingVertical: 16,\n    alignItems: 'center',\n    marginTop: 8,\n  },\n  buttonDisabled: {\n    opacity: 0.6,\n  },\n  loginButtonText: {\n    color: 'white',\n    fontSize: 18,\n    fontWeight: 'bold',\n  },\n  testInfo: {\n    textAlign: 'center',\n    marginTop: 16,\n    fontSize: 14,\n    color: colors.textSecondary,\n    fontStyle: 'italic',\n  },\n  homeContainer: {\n    flex: 1,\n    backgroundColor: colors.background,\n  },\n  header: {\n    backgroundColor: colors.surface,\n    padding: 24,\n    alignItems: 'center',\n    borderBottomLeftRadius: 20,\n    borderBottomRightRadius: 20,\n    marginBottom: 20,\n  },\n  welcomeTitle: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: colors.primary,\n    marginBottom: 8,\n  },\n  welcomeSubtitle: {\n    fontSize: 16,\n    color: colors.textSecondary,\n  },\n  statsContainer: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    paddingHorizontal: 20,\n    marginBottom: 24,\n  },\n  statCard: {\n    backgroundColor: colors.surface,\n    padding: 16,\n    borderRadius: 16,\n    alignItems: 'center',\n    flex: 1,\n    marginHorizontal: 4,\n  },\n  pendingCard: {\n    borderLeftWidth: 4,\n    borderLeftColor: colors.warning,\n  },\n  progressCard: {\n    borderLeftWidth: 4,\n    borderLeftColor: colors.secondary,\n  },\n  completedCard: {\n    borderLeftWidth: 4,\n    borderLeftColor: colors.success,\n  },\n  statIcon: {\n    fontSize: 24,\n    marginBottom: 8,\n  },\n  statNumber: {\n    fontSize: 20,\n    fontWeight: 'bold',\n    color: colors.text,\n  },\n  statLabel: {\n    fontSize: 12,\n    color: colors.textSecondary,\n    marginTop: 4,\n  },\n  sectionTitle: {\n    fontSize: 18,\n    fontWeight: 'bold',\n    color: colors.text,\n    paddingHorizontal: 20,\n    marginBottom: 16,\n  },\n  emptyState: {\n    alignItems: 'center',\n    padding: 40,\n  },\n  emptyText: {\n    fontSize: 18,\n    color: colors.textSecondary,\n    marginBottom: 8,\n  },\n  emptySubtext: {\n    fontSize: 14,\n    color: colors.textSecondary,\n    textAlign: 'center',\n  },\n  taskCard: {\n    backgroundColor: colors.surface,\n    marginHorizontal: 20,\n    marginBottom: 12,\n    borderRadius: 12,\n    padding: 16,\n  },\n  taskHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginBottom: 8,\n  },\n  taskTitle: {\n    fontSize: 16,\n    fontWeight: 'bold',\n    color: colors.text,\n    flex: 1,\n  },\n  priorityDot: {\n    width: 12,\n    height: 12,\n    borderRadius: 6,\n  },\n  taskDescription: {\n    fontSize: 14,\n    color: colors.textSecondary,\n    marginBottom: 8,\n  },\n  taskAddress: {\n    fontSize: 13,\n    color: colors.textSecondary,\n    marginBottom: 12,\n  },\n  taskFooter: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  statusBadge: {\n    paddingHorizontal: 12,\n    paddingVertical: 4,\n    borderRadius: 12,\n  },\n  statusText: {\n    color: 'white',\n    fontSize: 12,\n    fontWeight: 'bold',\n  },\n  taskTime: {\n    fontSize: 12,\n    color: colors.textSecondary,\n  },\n  refreshButton: {\n    backgroundColor: colors.secondary,\n    marginHorizontal: 20,\n    marginTop: 20,\n    paddingVertical: 16,\n    borderRadius: 12,\n    alignItems: 'center',\n  },\n  refreshText: {\n    color: 'white',\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n  logoutButton: {\n    backgroundColor: colors.surface,\n    marginHorizontal: 20,\n    marginTop: 12,\n    marginBottom: 30,\n    paddingVertical: 16,\n    borderRadius: 12,\n    alignItems: 'center',\n    borderWidth: 2,\n    borderColor: colors.error,\n  },\n  logoutText: {\n    color: colors.error,\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n});\n\nAppRegistry.registerComponent('main', () => App);\nexport default App;